<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>title</title>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
		integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<!-- Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin="" />

	<!--Jquery for language change-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!-- Fonts -->
	<!-- <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,800;1,800&display=swap"
		rel="stylesheet">  -->
	<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
	<style>
		body {
			background: #20282e;
			font-family: 'Open Sans', sans-serif;
			font-weight: 400;
		}

		h1 {
			font-weight: 800;
		}

		p {
			line-height: 1.7rem;
		}

		#map {
			height: 70vh;
			background: #20282e;
		}

		/* Small devices (landscape phones, 576px and up) */
		@media (min-width: 576px) {
			#map {
				height: 80vh;

			}
		}

		/* Medium devices (tablets, 768px and up) */
		@media (min-width: 768px) {

			aside {
				height: 80vh;
			}
		}

		/* Large devices (desktops, 992px and up) */
		@media (min-width: 992px) {}

		/* Extra large devices (large desktops, 1200px and up) */
		@media (min-width: 1200px) {}

		/* show those elements that match their language class */
	</style>

</head>

<body>
	<div class="container-fluid">
		<header class="row bg-dark text-white py-3">
			<div class="col">
				<!--h1>Who owns land in Mumbai?</h1-->
				<h1>
					<div id="heading">Land ownership and occupation: Mumbai's contested cityscape</div>
				</h1>
			</div>

			<!--Create drop down to change language, link with fun changeLang in js-->
			<form action="">
				<select type="text" id="dropBox" onchange="changeLang()">
					<option value="en">English</option>
					<option value="hi">Hindi</option>
					<option value="mr">Marathi</option>
				</select>

				<!--div id="divText">No template applied</div-->
			</form>
		</header>

		<section class="row">
			<!--div class="col-md-8 col-lg-9 col-xl-10 order-md-2 px-0"-->
			<div class="col-md-9 col-lg-7 col-xl-8 order-md-2 px-0">
				<div id="map"></div>
			</div>
			<div class='pointer'>
				<< Click search button</div> <!--aside id="about"
					class="col-md-4 col-lg-3 col-xl-2 order-md-1 text-white py-2 pl-3 bg-secondary overflow-auto" -->
					<aside id="about"
						class="col-md-3 col-lg-5 col-xl-4 order-md-1 text-white py-2 pl-3 bg-secondary overflow-auto">
						<section>

							<h3 class="py-2">
								<div id="aboutMap">About this map</div>
							</h3>
							<div id=infoTab>
								<p>In 2022, Mumbai city had the 11th highest Property Price Index
									in the world (<a
										href="https://www.numbeo.com/property-investment/rankings.jsp?title=2022"
										target="blank">Numbeo, 2022</a>).
									Geojson of informal settlement cluster outlines taken from the Slum Rehabilitation Authority (SRA).
									Data is from 2016
								</p>
								<p>Aim is to have this on swipe with the land ownership data. 
								</p>
							</div>
						</section>
					</aside>
		</section>

		<footer class="row bg-dark text-white py-3">
			<div class="col">
				<ul class="list-unstyled">
					<li>authored by <a href="https://github.com/sanjana-krish" target="_blank">sanjana</a></li>
					<li>Date of mapping: 11 Dec 2022; Date when data was extracted: Dec 2020</li>
					<li>data source: <a href="#">SRA</a></li>
				</ul>
			</div>
		</footer>
	</div>

	<!-- legend is outside of container-fluid and will be dynamically added to map -->
	<div class="bg-secondary py-2 px-3 ml-3 mt-3 text-white" id="legend"></div>


	<!-- Add Bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
		integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous">
	</script>
	<!-- then Leaflet JS -->
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>
	<!-- then Simple Statistics -->
	<script src='https://unpkg.com/simple-statistics@7.7.0/dist/simple-statistics.min.js'></script>

	<script>
		// initial Leaflet map options
		const options = {
			zoomSnap: .1,
			center: [19.076, 72.97], //[40, -90],
			zoom: 11, //4,
			zoomControl: false,
		}

		// create Leaflet map and apply options
		const map = L.map('map', options);
		const zoom = new L.control.zoom({
			position: "topleft"
		}).addTo(map);

		// request a basemap tile layer and add to the map
		L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);



		// fetch data from a remote source
		fetch("module_data/slum_2016.geojson")
			// after it is returned...
			.then(function (response) {
				// if has a property called ok, and it is true
				if (response.ok) {
					// The API call was successful!
					// Parse the JSON into a useable format, then return it
					//console.log(response.json)
					return response.json();
				} else {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
			})
			// The returned response is now data in a new then method
			.then(function (data) {
				// This is the JSON from our response
				console.log("data is ", data);
				// Pass the data to the drawMap function
				drawMap(data);
			});

		function drawMap(data) {
			// function is called one time, once the data is properly loaded. creates a new L.geoJson object and adds it to map, including basic
			// options for the map as well as some interactive mouseover style changes.
			// function then calls other functions to add the legend, update the map's thematic encoding (color), and add the UI dropdown element
			console.log("drawMap function is working");
			// create Leaflet data layer and add to map
			const wards = L.geoJson(data, {
				// style wards with initial default path options
				style: function (feature) {
					return {
						color: "#20282e",
						weight: 0.5,
						fillOpacity: 0.5,
						fillColor: "#1f78b4",
					};
				},

				// add hover/touch functionality to each feature layer
				onEachFeature: function (feature, layer) {
					// when mousing over a layer
					layer.on("mouseover", function () {
						// change the stroke color and bring that element to the front
						layer
							.setStyle({
								color: "#ff6e00",
							})
							.bringToFront();
					});

					// on mousing off layer
					layer.on("mouseout", function () {
						// reset the layer style to its original stroke color
						layer.setStyle({
							color: "#20282e",
						});
					});

				},
			}).addTo(map);

			// fit the map's bounds and zoom level using the wards extent
			map.fitBounds(wards.getBounds(), {
				// padding: [50, 0], // add padding around wards
				paddingBottomRight: [100, 0],
				animate: false
			});

			//updateMap(wards); // draw the map		
			wards.eachLayer(function (layer) {
				const props = layer.feature.properties;
				//console.log("layer.feature.props is", props); //CHANGE TO OWNERSHIP LATER

				// set the fill color of layer based on its normalized data value
				layer.setStyle({
					fillColor: "red",
				});

				// assemble string sequence of info for tooltip (end line break with + operator)
				let tooltipInfo = `Settlement name: ${props["slum_name"]} </br>
						SRA 2016 cluster ID: ${props["cluster_id"]} </br>
						Nearest landmark: ${props["nearest_la"]}</br>
						CTS numbers: ${props["cts_id"]}</br>
						Area: of cluster ${props["cluster_ar"]}`

				// bind a tooltip to layer with ward-specific information
				layer.bindTooltip(tooltipInfo, {
					// sticky property so tooltip follows the mouse
					sticky: true,
				});
			});	

		}

		function changeLang() {
			if (document.getElementById("dropBox").value == "en") {
				document.getElementById("heading").textContent =
					"Land ownership and occupation: Mumbai's contested cityscape";
				document.getElementById("aboutMap").innerHTML = "About this map";
				document.getElementById("infoTab").innerHTML =
					"<p>In 2022, Mumbai city had the 11th highest Property Price Index in the world. Land is limited in the peninsula and is frequently touted by the government as the reason for a large number of informal houses (called bastis or slums, where 52% of the city residents stay). However, there is very less information in the public sphere available about who owns land in the city, how much, and where. </p><p>This map uses data that from the Municipal Corporation of greater Mumbai (MCGM) obtained in December 2020. The dataset obtained has attributes on 'Ward', 'Ownership' and 'Land holder's name' for land parcels in Mumbai.";
				// can use + string + between to put in multiple lines
			} else if (document.getElementById("dropBox").value == "hi") {
				document.getElementById("heading").innerHTML = "जमीन के मालिक और निवासी: मुंबई के विवादित स्थल";
				document.getElementById("aboutMap").innerHTML = "इस नक्शे की जानकारी";
				document.getElementById("infoTab").innerHTML =
					"2022 में, मुंबई शहर का दुनिया में 11वां उच्चतम संपत्ति मूल्य सूचकांक था. भूमि शहर में सीमित है और अक्सर सरकार द्वारा बड़ी संख्या में अनौपचारिक घरों (जिन्हें बस्ती या झुग्गी कहा जाता है, जहां शहर के 52% निवासी रहते हैं) के कारण के रूप में बताया जाता है. <br><br>हालांकि, सार्वजनिक क्षेत्र में बहुत कम जानकारी उपलब्ध है कि शहर में किसकी जमीन है, कितनी और कहां है। यह नक्शा ग्रेटर मुंबई नगर निगम (एमसीजीएम) से दिसंबर 2020 में प्राप्त डेटा का उपयोग करता है। प्राप्त डेटासेट में मुंबई में भूमि पार्सल के लिए 'वार्ड', 'स्वामित्व' और 'भूमि धारक का नाम' की विशेषताएं हैं।";
			} else if (document.getElementById("dropBox").value == "mr") {
				document.getElementById("heading").innerHTML = "जमीन मालक आणि रहिवासी: मुंबईतील वादग्रस्त जागा";
				document.getElementById("aboutMap").innerHTML = "या नकाशाबद्दल";
				document.getElementById("infoTab").innerHTML =
					"2022 मध्ये, मुंबई शहर जगातील सर्वात जास्त मालमत्ता किंमत निर्देशांकात 11 व्या क्रमांकावर होते. शहरात जमीन मर्यादित आहे आणि मोठ्या संख्येने अनौपचारिक घरे (ज्याला बस्ती किंवा झोपडपट्ट्या म्हणतात, जेथे शहरातील 52% रहिवासी राहतात) याचे कारण अनेकदा सरकारद्वारे उद्धृत केले जाते. <br><br> मात्र, शहरात कोणाच्या मालकीची जमीन आहे, किती आणि कुठे आहे, याबाबत सार्वजनिक क्षेत्रात फारशी माहिती उपलब्ध नाही. हा नकाशा डिसेंबर 2020 मध्ये बृहन्मुंबई महानगरपालिकेकडून (MCGM) प्राप्त झालेल्या डेटाचा वापर करतो. मिळवलेल्या डेटासेटमध्ये मुंबईतील जमिनीच्या पार्सलसाठी 'वॉर्ड', 'मालकी' आणि 'जमीनधारकाचे नाव' या विशेषता आहेत.";
			}
		}
	</script>
</body>

</html>